<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ethan Browser</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
<style>
:root {
  --bg: #0e0e0e;
  --fg: #fff;
  --accent: #00aaff;
  --header: rgba(255,255,255,0.05);
}
body {
  margin:0;
  font-family:'Poppins',sans-serif;
  background:var(--bg);
  color:var(--fg);
  display:flex;
  flex-direction:column;
  height:100vh;
}
header {
  display:flex;
  align-items:center;
  gap:6px;
  padding:6px 10px;
  background:var(--header);
  backdrop-filter:blur(6px);
  flex-wrap:wrap;
}
header button {
  background: rgba(255,255,255,0.1);
  color: var(--fg);
  border: none;
  border-radius: 6px;
  padding:4px 10px;
  cursor:pointer;
  transition: background 0.3s;
}
header button:hover { background: rgba(255,255,255,0.2);}
#urlBar {
  flex:1;
  padding:4px 10px;
  border-radius:6px;
  border:none;
  background: rgba(255,255,255,0.1);
  color:#ccc;
  pointer-events:none;
}
#tabsBar {
  display:flex;
  gap:4px;
  background:var(--header);
  padding:4px 6px;
  overflow-x:auto;
}
#tabsBar button {
  background: rgba(255,255,255,0.1);
  border-radius:4px;
  border:none;
  padding:4px 8px;
  cursor:pointer;
}
#tabsBar button.active { background: var(--accent); }
iframe { flex:1; border:none; width:100%; }
footer { text-align:center; padding:4px; font-size:12px; color:#aaa; background:var(--header); }
.modalBackdrop { display:none; position:fixed; inset:0; background: rgba(0,0,0,0.6); backdrop-filter:blur(4px); z-index:1000; }
.modalWindow {
  display:none;
  position:fixed;
  top:50%;
  left:50%;
  transform:translate(-50%,-50%);
  background:#1c1c1c;
  border-radius:12px;
  padding:20px;
  width:300px;
  color:white;
  box-shadow:0 0 25px rgba(0,0,0,0.5);
  z-index:1001;
  text-align:center;
}
.modalWindow h2 { margin-top:0;}
.modalWindow button { margin:5px; padding:6px 12px; border:none; border-radius:6px; cursor:pointer; color:white;}
button.primary { background: var(--accent);}
button.ghost { background:#555;}
button.primary:hover { background:#18b0ff;}
button.ghost:hover { background:#777;}
#loadingOverlay {
  position:fixed; inset:0; display:none; justify-content:center; align-items:center;
  background: rgba(15,15,15,0.9); color:white; font-size:18px; z-index:999; flex-direction:column; gap:10px;
}
#loadingOverlay.active { display:flex; }
#loadingSpinner { width:32px; height:32px; border:4px solid rgba(255,255,255,0.3); border-top-color:white; border-radius:50%; animation:spin 0.8s linear infinite; }
@keyframes spin { from {transform:rotate(0deg);} to {transform:rotate(360deg);} }
</style>
</head>
<body>

<header>
  <button id="backBtn">‚Üê</button>
  <button id="forwardBtn">‚Üí</button>
  <button id="reloadBtn">‚ü≥</button>
  <button id="homeBtn">üè† Home</button>
  <button id="gamesBtn">üéÆ Games</button>
  <input id="urlBar" readonly placeholder="URL">
  <button id="menuBtn">‚ãØ</button>
  <button id="settingsBtn">‚öôÔ∏è Settings</button>
</header>

<div id="tabsBar"></div>

<div id="loadingOverlay">
  <div id="loadingSpinner"></div>
  <div id="loadingText">Loading...</div>
</div>

<iframe id="webFrame" sandbox="allow-scripts allow-same-origin allow-forms"></iframe>
<footer>Made by Ethan Tang v1.0.3</footer>

<!-- Settings Modal -->
<div id="settingsBackdrop" class="modalBackdrop"></div>
<div id="settingsModal" class="modalWindow">
  <h2>Settings</h2>
  <button class="ghost" onclick="toggleTheme()">Toggle Dark/Light Theme</button>
  <button class="ghost" onclick="openHistory()">Open Tab History</button>
  <button class="ghost" onclick="closeSettings()">Close</button>
</div>

<!-- History Modal -->
<div id="historyBackdrop" class="modalBackdrop"></div>
<div id="historyModal" class="modalWindow">
  <h2>Tab History</h2>
  <div id="historyLinks" style="display:flex; flex-direction:column; gap:6px;"></div>
  <button class="ghost" onclick="closeHistory()">Close</button>
</div>

<!-- Master menu modal -->
<div id="menuBackdrop" class="modalBackdrop"></div>
<div id="menuModal" class="modalWindow">
  <h2>All Pages</h2>
  <div id="menuLinks" style="display:flex; flex-direction:column; gap:6px;"></div>
  <button class="ghost" onclick="closeMenu()">Close</button>
</div>

<!-- Update Modal -->
<div id="updateBackdrop" class="modalBackdrop"></div>
<div id="updateModal" class="modalWindow">
  <h2>üîî Update Available</h2>
  <p id="updateMessage"></p>
  <div id="updateButtons"></div>
</div>

<script>
const allowedDomain = "https://ethanytangcodes.github.io";
const workerURL = "https://browserupdate.ethantytang11.workers.dev/version";
const currentVersion = "1.0.3";

const webFrame = document.getElementById("webFrame");
const urlBar = document.getElementById("urlBar");
const tabsBar = document.getElementById("tabsBar");

let tabs = JSON.parse(localStorage.getItem("tabs")) || [];
let activeTab = Number(localStorage.getItem("activeTab")) || 0;
if(!tabs.length) tabs.push({url:allowedDomain+"/index.html", history:[allowedDomain+"/index.html"], historyIndex:0});

function saveTabs(){ localStorage.setItem("tabs", JSON.stringify(tabs)); localStorage.setItem("activeTab", activeTab); }

function renderTabs(){
  tabsBar.innerHTML="";
  tabs.forEach((tab,i)=>{
    const b=document.createElement("button");
    b.textContent="Tab "+(i+1);
    if(i===activeTab) b.classList.add("active");
    b.onclick=()=>{ activeTab=i; loadTab(i); renderTabs(); };
    const closeBtn=document.createElement("span");
    closeBtn.textContent="‚úñ";
    closeBtn.style.marginLeft="4px";
    closeBtn.style.cursor="pointer";
    closeBtn.onclick=(e)=>{ e.stopPropagation(); closeTab(i); };
    b.appendChild(closeBtn);
    tabsBar.appendChild(b);
  });
  const addBtn=document.createElement("button");
  addBtn.textContent="+";
  addBtn.onclick=()=>{ addTab(); };
  tabsBar.appendChild(addBtn);
}

function loadTab(index){
  if(!tabs[index]) return;
  showLoading();
  webFrame.src = tabs[index].url;
  urlBar.value = tabs[index].url;
  saveTabs();
}

function addTab(){
  tabs.push({url:allowedDomain+"/index.html", history:[allowedDomain+"/index.html"], historyIndex:0});
  activeTab = tabs.length-1;
  renderTabs();
  loadTab(activeTab);
}

function closeTab(index){
  tabs.splice(index,1);
  if(activeTab>=tabs.length) activeTab=tabs.length-1;
  if(!tabs.length) addTab();
  renderTabs();
  loadTab(activeTab);
}

// Navigation buttons
document.getElementById("backBtn").onclick = ()=>{
  const tab=tabs[activeTab];
  if(tab.historyIndex>0){ tab.historyIndex--; tab.url=tab.history[tab.historyIndex]; loadTab(activeTab); }
};
document.getElementById("forwardBtn").onclick = ()=>{
  const tab=tabs[activeTab];
  if(tab.historyIndex<tab.history.length-1){ tab.historyIndex++; tab.url=tab.history[tab.historyIndex]; loadTab(activeTab); }
};
document.getElementById("reloadBtn").onclick = ()=>{ loadTab(activeTab); };
document.getElementById("homeBtn").onclick = ()=>{ navigateTab("home"); };
document.getElementById("gamesBtn").onclick = ()=>{ navigateTab("games"); };

// Settings modal
const settingsBackdrop=document.getElementById("settingsBackdrop");
const settingsModal=document.getElementById("settingsModal");
document.getElementById("settingsBtn").onclick=()=>{ settingsBackdrop.style.display="block"; settingsModal.style.display="block"; };
function closeSettings(){ settingsBackdrop.style.display="none"; settingsModal.style.display="none"; }

// History modal
const historyBackdrop=document.getElementById("historyBackdrop");
const historyModal=document.getElementById("historyModal");
const historyLinks=document.getElementById("historyLinks");
function openHistory(){
  historyLinks.innerHTML="";
  const tab=tabs[activeTab];
  tab.history.forEach(url=>{
    const b=document.createElement("button");
    b.className="ghost";
    b.textContent=url;
    b.onclick=()=>{ tab.url=url; tab.historyIndex=tab.history.indexOf(url); loadTab(activeTab); closeHistory(); };
    historyLinks.appendChild(b);
  });
  historyBackdrop.style.display="block";
  historyModal.style.display="block";
}
function closeHistory(){ historyBackdrop.style.display="none"; historyModal.style.display="none"; }

// Master menu modal
const menuBackdrop=document.getElementById("menuBackdrop");
const menuModal=document.getElementById("menuModal");
const menuLinks=document.getElementById("menuLinks");
document.getElementById("menuBtn").onclick = ()=>{
  menuLinks.innerHTML="";
  const routes={home:{label:"Home",path:"/index.html"},games:{label:"Games",path:"/art"},proxy:{label:"Proxy",path:"/active"},sinerider:{label:"Sinerider",path:"/sinerider"},gameboy:{label:"Gameboy",path:"/gamebois"},darkroom:{label:"A Dark Room",path:"/text-game"}};
  Object.entries(routes).forEach(([key,val])=>{
    const b=document.createElement("button");
    b.className="ghost";
    b.textContent=val.label;
    b.onclick=()=>{ navigateTab(key); closeMenu(); };
    menuLinks.appendChild(b);
  });
  menuBackdrop.style.display="block";
  menuModal.style.display="block";
};
function closeMenu(){ menuBackdrop.style.display="none"; menuModal.style.display="none"; }

// Theme toggle
let darkMode = localStorage.getItem("darkMode")==="true";
function toggleTheme(){
  darkMode=!darkMode;
  applyTheme();
}
function applyTheme(){
  if(darkMode){
    document.documentElement.style.setProperty("--bg","#0e0e0e");
    document.documentElement.style.setProperty("--fg","#fff");
    document.documentElement.style.setProperty("--accent","#00aaff");
  }else{
    document.documentElement.style.setProperty("--bg","#fff");
    document.documentElement.style.setProperty("--fg","#000");
    document.documentElement.style.setProperty("--accent","#0077cc");
  }
  localStorage.setItem("darkMode",darkMode);
}
applyTheme();

// Loading overlay
const loadingOverlay=document.getElementById("loadingOverlay");
function showLoading(text="Loading‚Ä¶"){ document.getElementById("loadingText").textContent=text; loadingOverlay.classList.add("active"); }
function hideLoading(){ loadingOverlay.classList.remove("active"); }
webFrame.addEventListener("load",()=>hideLoading());

// Navigation helper
function sanitizeUrl(url){ try{ const u=new URL(url,allowedDomain); if(u.origin===new URL(allowedDomain).origin) return u.href; return allowedDomain+"/index.html"; }catch{return allowedDomain+"/index.html";} }
function navigateTab(route){
  const routes={home:"/index.html",games:"/art"};
  const url = sanitizeUrl(allowedDomain + (routes[route]||"/index.html"));
  const tab = tabs[activeTab];
  tab.url=url;
  tab.history.push(url);
  tab.historyIndex=tab.history.length-1;
  loadTab(activeTab);
}

// Update modal
const updateBackdrop=document.getElementById("updateBackdrop");
const updateModal=document.getElementById("updateModal");
const updateMessage=document.getElementById("updateMessage");
const updateButtons=document.getElementById("updateButtons");

async function checkForUpdates(){
  if(!workerURL) return;
  try{
    const res = await fetch(workerURL);
    if(!res.ok) return;
    const data = await res.json();
    if(!data.version) return;
    if(data.version!==currentVersion){
      updateMessage.textContent = data.message||`New version ${data.version} available!`;
      updateButtons.innerHTML = `<button class="ghost" onclick="closeUpdate()">Close</button><button class="primary" onclick="window.location.href='${allowedDomain}/download'">Update</button>`;
      updateBackdrop.style.display="block";
      updateModal.style.display="block";
    }
  }catch(e){ console.warn("Update check failed:",e); }
}
function closeUpdate(){ updateBackdrop.style.display="none"; updateModal.style.display="none"; }

window.onload = ()=>{
  renderTabs();
  loadTab(activeTab);
  checkForUpdates();
};
</script>
</body>
</html>
